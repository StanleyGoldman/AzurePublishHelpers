<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Windows Azure Build &amp; Deployment Sample</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            MSBuild, Windows Azure, Visual Studio 2010
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Windows Azure, ALM, Build &amp; Deployment
                        </div>
                    </div>
                <div class="itemBar">
                    <label for="LastUpdated">Last Updated</label>
                    <div id="LastUpdated">12/5/2011</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Windows-Azure-Build-8cee065d">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy Code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p>Once you install the Windows Azure SDK on your development machine, it's easy to deploy your application to Windows Azure. However while this approach is fine for individual developers, project teams often prefer to build and deploy their code centrally
 on a build server. This improves the predictability of the build and deployment process, and also allows you to complete other tasks as a part of your build, such as running unit tests, deploying a database of versioning assemblies.</p>
<p>This sample includes scripts and tools that make it easy for you to set up centralised build and deployment of Windows Azure applications. The sample uses MSBuild and PowerShell, and assumes you are using Team Foundation Server for source control and build
 (although you should be able to use this sample as a starting point if you are using other ALM tools).</p>
<h1><span>Sample Contents</span></h1>
<p>This sample contains the following files and projects:</p>
<ul>
<li><strong>AzureDeploy.targets: </strong>An MSBuild Targets file which will automatically package your Windows Azure projects and call a PowerShell script to deploy it to the cloud.
</li><li><strong>AzureDeploy.ps1</strong>: A PowerShell script to deploy a packaged Windows Azure application to the cloud.
</li><li><strong>ImportPublishSettings.exe</strong>: A command-line tool which can import Windows Azure credentials from a .publishsettings file so it can be used on a build server
</li><li><strong>AzurePublishHelpers.dll</strong>: A library of helper functions used by AzureDeploy.ps1 and ImportPublishSettings.exe.
</li></ul>
<h1>Setting up your Build</h1>
<p><em>To set up your build server:</em></p>
<ol>
<li>Install Windows Azure SDK 1.6 (<a href="http://www.microsoft.com/windowsazure/sdk">http://www.microsoft.com/windowsazure/sdk</a>)
</li><li>Install Windows Azure Platform PowerShell Cmdlets (<a href="http://wappowershell.codeplex.com">http://wappowershell.codeplex.com</a>)
</li><li>Compile the code in this sample (ImportPublishSettings.exe and AzurePublishHelpers.dll)
</li><li>&nbsp;Copy both files to C:\Build on your build server </li><li>Install AzurePublishHelpers.dll as a PowerShell cmdlet by copying to: C:\Windows\System32\WindowsPowerShell\v1.0\Modules\AzurePublishHelpers&nbsp;(or C:\Windows\SysWOW64\WindowsPowerShell\v1.0\Modules\AzurePublishHelpers if you are running a 32-bit build
 on a 64-bit machine) </li><li>Copy AzureDeploy.ps1 to &quot;C:\Build&quot; (see comments in the file about changes if your&nbsp;build runs as NETWORK SERVICE)
</li><li>Copy AzureDeploy.targets to&nbsp;C:\Program Files\MSBuild\Microsoft\VisualStudio\v10.0\Windows Azure Tools\1.6\ImportAfter (32-bit OS) or C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v10.0\Windows Azure Tools\1.6\ImportAfter (64-bit OS)
</li><li>Go to <a href="http://code.msdn.microsoft.com/Windows-Azure-Build-8cee065d/https://windows.azure.com/download/publishprofile.aspx">http://code.msdn.microsoft.com/Windows-Azure-Build-8cee065d/https://windows.azure.com/download/publishprofile.aspx</a> to download a publish profile&nbsp;for your Windows Azure subscription.
</li><li>Run ImportPublishSettings.exe to import the subscription details and certificate onto the build server.<br>
If you're running the build as NETWORK SERVICE or similar non-user account:
<ol>
<li>Make sure you specify LocalMachine as the certificate store and a custom Windows Azure Connections file
</li><li>Use the Certificates MMC snap-in to grant access to the certificate private key to the build account
</li></ol>
</li></ol>
<p><em>To set up your Windows Azure project ready for the build:</em></p>
<ol>
<li>Open Visual Studio and open/create a new Windows Azure Project for your application
</li><li>Right-click on the Windows Azure Project (.ccproj) in Solution Explorer and choose Publish
</li><li>Configure all of the publish details for your project (specify the hosted service name, deployment&nbsp;slot, etc) and save this to an .azurePubXml file in the project. Cancel out of the dialog (i.e. you do not need to publish to Windows Azure from Visual
 Studio). </li><li>Check your solution into TFS source control. </li></ol>
<p><em>To set up your build definition in TFS:</em></p>
<ol>
<li>Open Visual Studio, connect to TFS via Team Explorer and set up a new Build Definition
</li><li>Configure the build definition details as appropriate for your project </li><li>On the Process tab, Expand the Advanced group, and enter the following under &quot;MSBuild Arguments&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp; /p:AzurePublishProfile=&quot;myServiceProduction.azurePubxml&quot;<br>
&nbsp;&nbsp; (or whatever you called your publish profile name) </li><li>Save the build, and kick it off! </li></ol>
<h1>More Information</h1>
<p>For more details on this sample, please see <a href="http://blogs.msdn.com/b/tomholl/archive/2011/12/06/automated-build-and-deployment-with-windows-azure-sdk-1-6.aspx">
Automated Build and Deployment with Windows Azure SDK 1.6</a>.</p>

</div>


    </div>
</body>
</html>
